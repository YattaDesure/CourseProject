# Ручной деплой на TimeWeb Cloud

## Проблема с MCP сервером

Если MCP сервер не работает (ошибка 401), можно настроить деплой вручную через веб-интерфейс TimeWeb.

## Шаг 1: Подготовка информации

### Git репозиторий
- **URL:** https://github.com/YattaDesure/Site.git
- **Ветка:** main
- **Коммит:** 483e7e2588ba931fc82fb8322bff6274615d4d01

### Frontend (Vue.js)
- **Тип:** Frontend
- **Фреймворк:** vue
- **Build context:** `frontend/`
- **Dockerfile:** `frontend/Dockerfile`
- **Build команда:** `npm run build`
- **Index директория:** `dist`
- **Переменные окружения:**
  - `VITE_API_URL` - URL вашего бэкенда (например, `http://localhost:5001` для разработки)

### Backend (ASP.NET Core) - опционально
- **Тип:** Backend
- **Фреймворк:** docker
- **Build context:** `backend/`
- **Dockerfile:** `backend/Dockerfile`
- **Переменные окружения:**
  - `ConnectionStrings__DefaultConnection` - строка подключения к БД
  - `JWT__SecretKey` - секретный ключ для JWT
  - `JWT__Issuer` - издатель токена
  - `JWT__Audience` - аудитория токена

## Шаг 2: Добавление VCS провайдера

1. Зайдите в панель TimeWeb Cloud
2. Перейдите в раздел "VCS провайдеры" или "Git"
3. Нажмите "Добавить провайдер"
4. Выберите тип: **Git** (для публичных репозиториев) или **GitHub**
5. Введите URL: `https://github.com/YattaDesure/Site.git`
6. Для публичных репозиториев логин/пароль не нужны
7. Сохраните провайдер

## Шаг 3: Создание Frontend приложения

1. В панели TimeWeb перейдите в "Приложения"
2. Нажмите "Создать приложение"
3. Выберите тип: **Frontend**
4. Выберите ваш VCS провайдер
5. Выберите репозиторий: `Site`
6. Выберите ветку: `main`
7. Выберите коммит: `483e7e2588ba931fc8322bff6274615d4d01` (или последний)
8. Выберите пресет: **Vue.js** или **Node.js**
9. Настройте параметры сборки:
   - **Build context:** `frontend/`
   - **Dockerfile:** `frontend/Dockerfile` (или оставьте автоматический)
   - **Build команда:** `npm run build`
   - **Index директория:** `dist`
10. Добавьте переменные окружения:
    - `VITE_API_URL` = URL вашего бэкенда
11. Нажмите "Создать"

## Шаг 4: Настройка Backend (если нужно)

1. Создайте новое приложение типа **Backend**
2. Выберите тот же репозиторий и ветку
3. Выберите пресет: **Docker**
4. Настройте параметры:
   - **Build context:** `backend/`
   - **Dockerfile:** `backend/Dockerfile`
5. Добавьте переменные окружения:
   - `ConnectionStrings__DefaultConnection` = строка подключения к вашей БД
   - `JWT__SecretKey` = секретный ключ
   - `JWT__Issuer` = ваш домен
   - `JWT__Audience` = ваш домен
6. Сохраните

## Шаг 5: Настройка туннеля для БД

Так как база данных на вашем ноутбуке:

1. Запустите туннель (ngrok или cloudflared):
   ```bash
   ./start-db-tunnel.sh
   ```
2. Скопируйте полученный URL туннеля
3. Обновите строку подключения в переменных окружения:
   ```
   Server=ваш_туннель_урл;Database=GreenQuarter;User Id=sa;Password=ваш_пароль;TrustServerCertificate=True;
   ```

## Шаг 6: Деплой

1. После создания приложения нажмите "Деплой"
2. Дождитесь завершения сборки
3. Проверьте логи на наличие ошибок
4. После успешного деплоя получите URL приложения

## Полезные ссылки

- Подробная инструкция: `DEPLOY_TIMEWEB.md`
- С локальной БД: `DEPLOY_WITH_LOCAL_DB.md`
- С Docker БД: `DEPLOY_DOCKER_DB.md`

## Решение проблем

### Ошибка сборки
- Проверьте, что Build context указан правильно (`frontend/` для фронтенда)
- Убедитесь, что Dockerfile существует
- Проверьте логи сборки

### Ошибка подключения к БД
- Убедитесь, что туннель запущен
- Проверьте строку подключения
- Убедитесь, что БД доступна извне

### Ошибка 401 в MCP
- Проверьте права API токена в панели TimeWeb
- Убедитесь, что токен не истек
- Попробуйте создать новый токен

